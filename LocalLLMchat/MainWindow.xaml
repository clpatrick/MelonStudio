<Window
    x:Class="LocalLLMchat.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:LocalLLMchat"
    xmlns:vm="using:LocalLLMchat.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:LocalLLMchat.Models"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Chat History -->
        <ListView ItemsSource="{x:Bind ViewModel.Messages}" SelectionMode="None">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:ChatMessage">
                    <Grid Padding="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        
                        <!-- Simple visual distinction -->
                        <TextBlock Text="{x:Bind Role}" FontWeight="Bold" Width="80" VerticalAlignment="Top" 
                                   Foreground="AccentTextFillColorPrimaryBrush"/>
                        
                        <TextBlock Grid.Column="1" Text="{x:Bind Content}" TextWrapping="Wrap" 
                                   IsTextSelectionEnabled="True" Margin="10,0,0,0"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Input Area -->
        <Border Grid.Row="1" Background="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="0,1,0,0" Padding="20">
            <Grid ColumnSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBox Text="{x:Bind ViewModel.InputMessage, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         PlaceholderText="Type a message..." 
                         AcceptsReturn="True" TextWrapping="Wrap" MaxHeight="100"/>
                
                <Button Grid.Column="1" Content="Send" Command="{x:Bind ViewModel.SendMessageCommand}" Style="{StaticResource AccentButtonStyle}"/>
                
                <Button Grid.Column="2" Content="Load Model" Command="{x:Bind ViewModel.LoadModelCommand}" />
            </Grid>
        </Border>
        
        <!-- Status Overlay -->
        <Grid Grid.RowSpan="2" Background="#80000000" Visibility="{x:Bind ViewModel.IsGenerating, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}" 
              x:Name="LoadingOverlay" IsHitTestVisible="False" d:Visibility="Collapsed">
             <!-- Note: Converter requires resource dictionary setup. 
                  For MVP simplicity strictly in XAML, we might skip converter or implement fallback.
                  Let's use a TextBlock bound to StatusMessage in the input area instead of complex overlay for now to avoid resource issues.
             -->
        </Grid>
        
        <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" Grid.Row="1" VerticalAlignment="Top" HorizontalAlignment="Left" 
                   Margin="20,-20,0,0" FontSize="10" Foreground="Gray"/>
    </Grid>
</Window>
